#!/bin/bash
# Generate architecture documentation using static analysis

PROJECT_ROOT="$(cd "$(dirname "$0")/../.." && pwd)"
cd "$PROJECT_ROOT"

echo "üîÑ Generating architecture documentation..."

# Create docs directory
mkdir -p docs

# Run codebrain.mjs if it exists
if [ -f "workspace/static-analysis/codebrain.mjs" ]; then
  echo "Running codebrain.mjs tree..."
  node workspace/static-analysis/codebrain.mjs tree src > docs/ARCHITECTURE.md 2>&1
  if [ $? -eq 0 ]; then
    echo "‚úÖ docs/ARCHITECTURE.md generated"
  else
    echo "‚ö†Ô∏è  codebrain.mjs failed, check docs/ARCHITECTURE.md for details"
  fi
else
  echo "‚ö†Ô∏è  codebrain.mjs not found, skipping"
fi

# Run flow-doc.cjs from project root
if [ -f "workspace/static-analysis/flow-doc.cjs" ]; then
  echo "Running flow-doc.cjs..."
  node workspace/static-analysis/flow-doc.cjs > docs/FLOW.md 2>&1
  if [ $? -eq 0 ]; then
    echo "‚úÖ docs/FLOW.md generated"
  else
    echo "‚ö†Ô∏è  flow-doc.cjs failed, check docs/FLOW.md for details"
  fi
else
  echo "‚ö†Ô∏è  flow-doc.cjs not found, skipping"
fi

echo "‚úÖ Documentation generation complete"
ls -lh docs/
